<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="order_processing_view_form" model="ir.ui.view">
        <field name="name">order.processing.form.sale</field>
        <field name="model">order.processing</field>
        <field name="inherit_id" ref="order_processing.order_processing_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[hasclass('oe_stat_button')]" position="after">
                <button class="oe_stat_button" type="object" name="action_sale_count"
                        icon="fa-line-chart">
                    <field string="Sales" name="sale_count" widget="statinfo"/>
                </button>
            </xpath>
            <xpath expr="//page[@name='other_info']" position="before">
                <page name="sale_info" string="Sale info">
                    <header>
                        <button name="action_create_quotation" string="Create Quotation" type="object"
                                class="oe_highlight"/>
                        <button name="update_product_line_rfq_to_sale" string="Update from RFQ" type="object"
                                class="oe_highlight"/>
                    </header>
                    <field name="order_processing_sale_line" widget="section_and_note_one2many" mode="tree">
                        <tree string="Sale Order Line" editable="bottom">
                            <control>
                                <create name="add_product_control" string="Add a product"/>
                                <!--                                        <create name="add_section_control" string="Add a section"-->
                                <!--                                                context="{'default_display_type': 'line_section'}"/>-->
                                <!--                                        <create name="add_note_control" string="Add a note"-->
                                <!--                                                context="{'default_display_type': 'line_note'}"/>-->
                            </control>
                            <field name="company_id" invisible="1"/>
                            <field name="sequence" widget="handle"/>
                            <field name="sequence_number"/>
                            <field name="product_id"/>
                            <field name="default_code"/>
                            <field name="name" widget="section_and_note_text" optional="show"/>
                            <field name="product_uom_qty"/>
                            <field name="product_uom" groups="uom.group_uom"/>
                            <field name="price_unit"/>
                            <field name="tax_id" widget="many2many_tags" options="{'no_create': True}"
                                   context="{'search_view_ref': 'account.account_tax_view_search'}"
                                   domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"/>
                            <field name="price_subtotal" widget="monetary"
                                   groups="account.group_show_line_subtotals_tax_excluded"/>
                        </tree>
                    </field>
                    <group name="note_group" col="6" class="mt-2 mt-md-0">
                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                            <field name="amount_untaxed_sale" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="amount_tax_sale" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                <label for="amount_total_sale"/>
                            </div>
                            <field name="amount_total_sale" nolabel="1" class="oe_subtotal_footer_separator"
                                   widget="monetary" options="{'currency_field': 'currency_id'}"/>
                        </group>
                        <div class="oe_clear"/>
                    </group>


                    <group>
                        <label for="sale_term_ids" string="Sale Term"/>
                        <field name="sale_term_ids" nolabel="1" colspan="4" limit="20">
                            <tree string="Sales terms" editable="bottom">
                                <field name="sequence" widget="handle"/>
                                <field name="sequence_number"/>
                                <field name="name"/>
                                <field name="description"/>
                            </tree>
                        </field>
                    </group>
                    <group>
                        <group>
                            <field name="bank_account_id"/>
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//sheet//group//group//field[@name='type']" position="after">
                <field name="pricelist_id"/>
            </xpath>
        </field>
    </record>
</odoo>