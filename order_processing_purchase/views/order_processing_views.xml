<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="order_processing_view_form" model="ir.ui.view">
        <field name="name">order.processing.form.purchase</field>
        <field name="model">order.processing</field>
        <field name="inherit_id" ref="order_processing.order_processing_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button class="oe_stat_button" type="object" name="action_purchase_count"
                        icon="fa-cart-plus">
                    <field string="Purchase" name="purchase_count" widget="statinfo"/>
                </button>
            </xpath>
            <xpath expr="//page[@name='other_info']" position="before">
                <page name="rfq" string="RFQ">
                    <button name="action_create_rfq" string="Create RFQ" type="object"
                            class="oe_highlight"/>
                    <field name="order_line_rfq"
                           widget="section_and_note_one2many"
                           mode="tree">
                        <tree string="Purchase Order Lines" editable="bottom">
                            <field name="company_id" invisible="1"/>
                            <field name="display_type" invisible="1"/>

                            <field name="sequence" widget="handle"/>
                            <field name="sequence_number"/>
                            <field
                                    name="product_id"
                                    attrs="{'required': [('display_type', '=', False)],}"
                                    context="{'partner_id':parent.partner_id, 'quantity':product_qty,'uom':product_uom, 'company_id': parent.company_id}"
                                    force_save="1"
                                    domain="[('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"/>
                            <field name="default_code"/>
                            <field name="name" widget="section_and_note_text"/>
                            <field name="partner_id"/>
                            <field name="product_qty"/>
                            <field name="product_uom" string="UoM" groups="uom.group_uom"
                                   attrs="{'required': [('display_type', '=', False)]}"/>
                            <field name="currency_id"/>
                            <field name="price_unit"/>
                            <field name="taxes_id" widget="many2many_tags"
                                   domain="[('type_tax_use','=','purchase'), ('company_id', '=', parent.company_id)]"
                                   context="{'default_type_tax_use': 'purchase', 'search_view_ref': 'account.account_tax_view_search'}"
                                   options="{'no_create': True}" optional="show"/>
                            <field name="price_subtotal" widget="monetary"/>
                        </tree>
                    </field>
                    <group class="oe_subtotal_footer oe_right">
                        <field name="amount_untaxed_rfq" widget="monetary"
                               options="{'currency_field': 'currency_id'}"/>
                        <field name="amount_tax_rfq" widget="monetary"
                               options="{'currency_field': 'currency_id'}"/>
                        <div class="oe_subtotal_footer_separator oe_inline">
                            <label for="amount_total_rfq"/>
                        </div>
                        <field name="amount_total_rfq" nolabel="1" class="oe_subtotal_footer_separator"
                               widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    </group>
                    <group>
                        <label for="purchase_term_ids" string="Purchase Term"/>
                        <field name="purchase_term_ids" nolabel="1" colspan="4" limit="20">
                            <tree string="Purchase terms" editable="bottom">
                                <field name="sequence" widget="handle"/>
                                <field name="sequence_number"/>
                                <field name="name"/>
                                <field name="description"/>
                            </tree>
                        </field>
                    </group>

                </page>
            </xpath>
        </field>
    </record>
</odoo>